<div class = "opacity-100">
<div class="flex flex-col gap-4 p-4 z-20">
 <div class="relative group">
  <input type="text"
    class="block w-full p-3 pr-10 text-sm rounded-lg bg-surface-light dark:bg-surface-dark border border-slate-300 dark:border-slate-700 placeholder-transparent focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary focus:outline-none shadow-sm transition-all"
    [(ngModel)]="searchQuery" (input)="filterBooks()" />
  <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
    <mat-icon class="text-slate-400 group-focus-within:text-primary transition-colors text-base">search</mat-icon>
  </div>
</div>


  <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
    <button *ngFor="let cat of categories" (click)="filterCategory(cat)"
      class="flex h-9 shrink-0 items-center justify-center px-4 rounded-full"
      [ngClass]="{
        'bg-primary text-background-dark font-bold shadow-lg shadow-primary/20': selectedCategory === cat,
        'bg-surface-light dark:bg-surface-dark border border-slate-300 dark:border-slate-700 text-slate-600 dark:text-slate-300 font-medium': selectedCategory !== cat
      }">
      {{ cat }}
    </button>
  </div>
</div>
<div class="flex justify-end px-4 pb-2">
  <button (click)="sortByLowestStock()" class="flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-surface-light dark:bg-surface-dark border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-white hover:bg-primary hover:text-white transition-colors">
    <mat-icon class="text-base">sort</mat-icon>
    Sort by Lowest Stock
  </button>
</div>

<div class="flex flex-col gap-3 px-4">
  <div *ngFor="let book of filteredBooks;let i = index"
       class="relative group flex items-start gap-4 p-3 bg-surface-light dark:bg-surface-dark rounded-xl border border-slate-300 dark:border-slate-700 shadow-sm transition-all hover:scale-[1.01]">

    <div class="shrink-0 w-20 h-28 rounded-lg bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-slate-500 dark:text-slate-300 text-lg">
      <mat-icon class="text-slate-400 dark:text-slate-400">book</mat-icon>
    </div>

    <div class="flex-1 min-w-0 flex flex-col h-full justify-between py-0.5">
      <div>
        <div class="flex justify-between items-start ">
          <h3 class="text-base font-bold leading-tight line-clamp-2 pr-6 text-slate-900 dark:text-white">{{ book.title }}</h3>
          <span class="text-sm font-semibold text-slate-900 dark:text-white mr-5">$ {{ book.price.toFixed(2) }}</span>

        </div>
       <div class="flex items-center justify-center gap-2 mt-2 flex-wrap max-w-sm">
  <span class="text-xs font-medium text-slate-500 dark:text-slate-400 mr-2">Quantity</span>
  <div class="flex items-center justify-center gap-1 rounded-lg p-1 border flex-shrink " [style.background-color]="'var(--background_color)'" >
   <button class="qntbtn" (click)="decreaseStock(i)" [disabled]="book.stock === 0">
  <mat-icon>remove</mat-icon>
</button>
<input class="txt w-5 text-center bg-transparent font-bold text-sm text-slate-900 dark:text-white border-none focus:ring-0 p-0"
       [value]="book.stock" readonly>
<button class="qntbtn" (click)="increaseStock(i)">
  <mat-icon>add</mat-icon>
</button>

  </div>
</div>


        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1 font-medium">{{ book.authors.join(', ') }}</p>
        <p class="text-[10px] text-slate-400 dark:text-slate-500 mt-0.5 font-mono">ISBN: {{ book.isbn }}</p>
      </div>

      <div class="flex items-center gap-2 mt-3">
        <span
          class="inline-flex items-center px-3 py-1 rounded-full text-[10px] font-bold text-white"
          [ngClass]="{
            'bg-green-600': book.stock > 10,
            'bg-orange-500': book.stock > 0 && book.stock <= 10,
            'bg-red-600': book.stock === 0
          }">
          {{ book.stock }} in Stock
        </span>
        <span class="inline-flex items-center px-3 py-1 rounded-full text-[10px] font-bold bg-white text-black catgory">
          {{ book.category }}
        </span>
      </div>
    </div>
    <div >
<button class="editbtn text-slate-400 hover:text-primary" (click)="openEdit(book, i)">
            <mat-icon>edit</mat-icon>
          </button></div>
  </div>
</div>
</div>

<button class="addbtn text-[30px] z-50 text-slate-400 hover:text-primary text-sm" (click)="openForm()">
  <mat-icon>add</mat-icon>

</button>

<div *ngIf="showNewBookForm" class="fixed fade inset-0 z-50 bg-black/50 overflow-y-auto fade" (click)="closeForm()">

<section class="pt-5 ">
<form [formGroup]="NewBookForm" (ngSubmit)="getValues()" (click)="$event.stopPropagation()" class="max-w-sm mx-auto mt-5 p-6 rounded-lg shadow-lg  NewBookForm shadow-t-4 shadow-cyan-300 border-solid  border-slate-500 m-5  ">


<div class="mb-5">
<label class="block mb-2 text-sm font-medium ">Book Name</label>
<input formControlName="Bookname" class="bg-white border border-gray-300 text-sm rounded-lg block w-full p-2.5" />
<app-errormsg
  [control]="NewBookForm.get('Bookname')"
  label="Book Name">
</app-errormsg>
</div>

<div class="mb-5">
<label class="block mb-2 text-sm font-medium ">authorName</label>
<input formControlName="authorName" class="bg-white border border-gray-300 text-sm rounded-lg block w-full p-2.5" />
<app-errormsg
  [control]="NewBookForm.get('authorName')"
  label="Author Name">
</app-errormsg>
</div>

<div class="mb-5">
<label class="block mb-2 text-sm font-medium ">Category</label>
<select formControlName="Category" class="bg-white border border-gray-300 text-sm rounded-lg block w-full text-black p-2.5">
  <option value="" disabled selected>Select category</option>
  <option *ngFor="let cat of categories" [value]="cat" [disabled]="cat === 'All'">{{ cat }}</option>
</select>
<app-errormsg
  [control]="NewBookForm.get('Category')"
  label="Category">
</app-errormsg>
</div>

<div class="mb-5">
<label class="block mb-2 text-sm font-medium ">Quantity</label>
<input formControlName="Quantity" class="bg-white border border-gray-300 text-sm rounded-lg block w-full p-2.5" />
<app-errormsg
  [control]="NewBookForm.get('Quantity')"
  label="Quantity">
</app-errormsg>
</div>

<div class="mb-5">
<label class="block mb-2 text-sm font-medium ">Publisher</label>
<input formControlName="Publisher" class="bg-white border border-gray-300 text-sm rounded-lg block w-full p-2.5" />
<app-errormsg
  [control]="NewBookForm.get('Publisher')"
  label="Publisher">
</app-errormsg>
</div>

<div class="mb-5">
<label class="block mb-2 text-sm font-medium ">Price</label>
<input formControlName="Price" class="bg-white border border-gray-300 text-sm rounded-lg block w-full p-2.5" />
<app-errormsg
  [control]="NewBookForm.get('Price')"
  label="Price">
</app-errormsg>
</div>

<button type="submit" [disabled]="NewBookForm.invalid" class="w-full px-5 py-2.5 text-sm font-medium rounded-lg text-white bg-green-600 disabled:bg-gray-400 disabled:opacity-70 disabled:cursor-not-allowed">
Submit
</button>

</form>
</section>
</div>
